generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Bike {
  id              Int      @id @default(autoincrement())
  model           String   // Tên xe
  status          String   // Tình trạng xe: "available", "rented", "maintenance"
  lock            Boolean
  location        String   // Vị trí đỗ
  price           Float    // Giá xe trên 1 ngày
  park_id         Int
  Park            Park     @relation(fields: [park_id], references: [id])
  Rental          Rental[]
  image           String?  // Hình ảnh về xe
  
  // Thông tin đánh giá
  rating          Float?   @default(0)  // Số sao trung bình (0-5)
  review_count    Int?     @default(0)  // Số lượt đánh giá
  
  // Thông tin cung cấp
  dealer_name     String?  // Tên đại lý/dealer cung cấp
  dealer_contact  String?  // Thông tin liên hệ dealer
  
  // Thông tin kỹ thuật
  seats           Int?     // Số chỗ ngồi
  fuel_type       String?  // "electric" hoặc "gasoline"
  transmission    String?  // "automatic" hoặc "manual"
  
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
}

model Park {
  id         Int      @id @default(autoincrement())
  name       String
  location   String
  Bike       Bike[]
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  image      String?
  dealer_id  Int?
  Dealer     User?    @relation("DealerParks", fields: [dealer_id], references: [id])
}

model User {
  id             Int              @id @default(autoincrement())
  name           String
  email          String           @unique
  password       String
  role           String           @default("user")
  Rental         Rental[]
  Parks          Park[]           @relation("DealerParks")
  BookingRequest BookingRequest[]
  created_at     DateTime         @default(now())
  updated_at     DateTime         @updatedAt
  birthdate      DateTime
  phone          String?
  image          String?
}

model Rental {
  id         Int       @id @default(autoincrement())
  user_id    Int
  bike_id    Int
  start_time DateTime
  end_time   DateTime?
  status     String
  price      Float
  User       User      @relation(fields: [user_id], references: [id], onDelete: Cascade)
  Bike       Bike      @relation(fields: [bike_id], references: [id], onDelete: Cascade)
  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt
  qrcode     String?
  payment_id String?
  order_id   String?
}

model BookingRequest {
  id              Int      @id @default(autoincrement())
  user_id         Int?
  name            String
  email           String
  contact_method  String
  contact_details String
  pickup_location String
  status          String   @default("PENDING")
  admin_notes     String?
  User            User?    @relation(fields: [user_id], references: [id], onDelete: SetNull)
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
}
